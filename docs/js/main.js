let scrollElems=document.getElementsByClassName("scrollPage"),article=document.querySelector(".article"),durationTime=[400,600,800],indexOfSlowest=durationTime.indexOf(Math.max(...durationTime)),durationSetAdditional=[250,250,250],durationTimeBG=[];for(let i=0;i<durationTime.length;i++)durationTimeBG[i]=durationTime[i]+2*durationSetAdditional[i];let currentProgress,finalDestinationBottom,finalDestinationTop,durationZero=[0,0,0],pow=2,gradDBA={color:[[231,78,44],[254,156,100]]},gradMustang={color:[[85,75,161],[105,199,237]]},grad={},compareGrad={},currentGrad={color:[[],[]]},slidePhones=document.getElementsByClassName("col-slide"),initTop=[],finalTop=[],phoneHeight=.6*window.innerHeight,cecilElems=[document.getElementsByClassName("colLeftCecil"),document.getElementsByClassName("colCenterCecil"),document.getElementsByClassName("colRightCecil")],dbaElems=[document.getElementsByClassName("colLeftDBA"),document.getElementsByClassName("colCenterDBA"),document.getElementsByClassName("colRightDBA")],distance=window.innerHeight,currentTopCecil=[],newTopCecil=[],currentTopDBA=[],newTopDBA=[],stopMove=!1;function animate({timing,draw,duration}){let start=performance.now();requestAnimationFrame(function animate(time){let timeFraction=(time-start)/duration;timeFraction>1&&(timeFraction=1);let progress=timing(timeFraction);draw(progress),timeFraction<1&&!stopMove&&requestAnimationFrame(animate)})}function change(paramGrad1,paramGrad2,element,timeDurationSet){(grad={...paramGrad1}).color=[...paramGrad1.color],compareGrad.color=[...paramGrad2.color],compareGrad={...paramGrad2};for(let j=0;j<grad.color.length;j++)grad.color[j]=[...paramGrad1.color[j]],compareGrad.color[j]=[...paramGrad2.color[j]];bgColor(element,timeDurationSet)}function bgColor(elem,setDuration){return animate({duration:Math.max(...setDuration),timing:function(timeFraction){return timeFraction},draw:function(progress){for(let i=0;i<2;i++)for(let j=0;j<3;j++)currentGrad.color[i][j]=grad.color[i][j]+(compareGrad.color[i][j]-grad.color[i][j])*progress;elem.style.backgroundImage="linear-gradient(117deg, rgb("+currentGrad.color[0]+"), rgb("+currentGrad.color[1]+"))"}})}function currentPos(){for(let i=0;i<scrollElems.length;i++)if(window.scrollY+window.innerHeight/2>=scrollElems[i].offsetTop&&window.scrollY+window.innerHeight/2<scrollElems[i].offsetTop+scrollElems[i].clientHeight)return i}function dbaSection(){for(let i=0;i<scrollElems.length;i++)if("dbafitness"==scrollElems[i].id)return i}function mustangSection(){for(let i=0;i<scrollElems.length;i++)if("mustangchain"==scrollElems[i].id)return i}function mobileMove(durationSet){return new Promise((res,rej)=>{for(let index=0;index<slidePhones.length;index++)animate({duration:durationSet[index],timing:function(timeFraction){return Math.pow(timeFraction,pow)},draw:function(progress){slidePhones[index].style.transform="translateY("+(progress*finalTopArray[index]+(1-progress)*startTopArray[index])+"px)",currentProgress[index]=progress*finalTopArray[index]+(1-progress)*startTopArray[index],1==progress&&index==indexOfSlowest&&(console.log("resolved"),res())}})})}function topMove(durationSet){return new Promise((res,rej)=>{for(let index=0;index<slidePhones.length;index++)newTopCecil[index]||(newTopCecil[index]=0),currentTopCecil[index]=newTopCecil[index],finalDestinationTop=finalDestinationTop==-1*distance?-1*distance:0,animate({duration:durationSet[index],timing:function(timeFraction){return Math.pow(timeFraction,pow)},draw:function(progress){for(let i=0;i<cecilElems[index].length;i++)cecilElems[index][i].style.transform="translateY("+((1-progress)*currentTopCecil[index]+progress*finalDestinationTop)+"px)";newTopCecil[index]=(1-progress)*currentTopCecil[index]+progress*finalDestinationTop,1==progress&&index==indexOfSlowest&&res()}})})}function bottomMove(durationSet){return new Promise((res,rej)=>{for(let index=0;index<slidePhones.length;index++)newTopDBA[index]||(newTopDBA[index]=0),currentTopDBA[index]=newTopDBA[index],finalDestinationBottom=finalDestinationBottom==distance?distance:0,animate({duration:durationSet[index],timing:function(timeFraction){return Math.pow(timeFraction,pow)},draw:function(progress){for(let i=0;i<dbaElems[index].length;i++)dbaElems[index][i].style.transform="translateY("+((1-progress)*currentTopDBA[index]+progress*finalDestinationBottom)+"px)";newTopDBA[index]=(1-progress)*currentTopDBA[index]+progress*finalDestinationBottom,1==progress&&index==indexOfSlowest&&res()}})})}window.addEventListener("load",function(){let shiftTop=[0,.22*window.innerHeight,.02*window.innerHeight],shiftBottom=[.4*window.innerHeight,.22*window.innerHeight,2*phoneHeight];for(let i=0;i<slidePhones.length;i++)initTop[i]=slidePhones[i].offsetTop+shiftTop[i];for(let i=0;i<slidePhones.length;i++)finalTop[i]=initTop[i]+5.3*phoneHeight-shiftTop[i]-shiftBottom[i];currentPos()>dbaSection()?(firstEnterMustang=!1,firstEnterDBA=!0,newTopDBA=[0,0,0],finalDestinationBottom=distance,newTopCecil=[-1*distance,-1*distance,-1*distance],finalDestinationTop=0,currentProgress=[...initTop],finalTopArray=[...finalTop],startTopArray=[...currentProgress],change(gradDBA,gradMustang,article,durationZero),topMove(durationZero).then(()=>mobileMove(durationZero)).then(()=>bottomMove(durationZero))):(firstEnterDBA=!1,firstEnterMustang=!0,newTopDBA=[distance,distance,distance],finalDestinationBottom=0,newTopCecil=[0,0,0],finalDestinationTop=-1*distance,currentProgress=[...finalTop],finalTopArray=[...initTop],startTopArray=[...currentProgress],change(gradMustang,gradDBA,article,durationZero),bottomMove(durationZero).then(()=>mobileMove(durationZero)).then(()=>topMove(durationZero))),document.addEventListener("scroll",function(event){if(currentPos()==dbaSection()&&1==firstEnterDBA){new Promise((res,rej)=>{stopMove=!0,setTimeout(()=>{res()},0)}).then(()=>{stopMove=!1,finalDestinationBottom=0,finalDestinationTop=-1*distance,finalTopArray=[...initTop],startTopArray=[...currentProgress],change(currentGrad,gradDBA,article,durationTimeBG),bottomMove(durationSetAdditional).then(()=>mobileMove(durationTime)).then(()=>topMove(durationSetAdditional))}),firstEnterDBA=!1,firstEnterMustang=!0}else if(currentPos()==mustangSection()&&1==firstEnterMustang){new Promise((res,rej)=>{stopMove=!0,setTimeout(()=>{res()},0)}).then(()=>{stopMove=!1,finalDestinationTop=0,startTopArray=[...currentProgress],finalTopArray=[...finalTop],finalDestinationBottom=distance,change(currentGrad,gradMustang,article,durationTimeBG),topMove(durationSetAdditional).then(()=>mobileMove(durationTime)).then(()=>bottomMove(durationSetAdditional))}),firstEnterMustang=!1,firstEnterDBA=!0}})});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiIiwic291cmNlcyI6WyJtYWluLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIFZhcmlhYmxlc1xyXG5sZXQgc2Nyb2xsRWxlbXMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdzY3JvbGxQYWdlJyk7XHJcbmxldCBhcnRpY2xlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmFydGljbGUnKTtcclxubGV0IGR1cmF0aW9uVGltZSA9IFs0MDAsIDYwMCwgODAwXTsgLy90aW1lIG9mIGFuaW1hdGlvbiBkdXJhdGlvbiBmb3IgbW9iaWxlXHJcbmxldCBpbmRleE9mU2xvd2VzdCA9IGR1cmF0aW9uVGltZS5pbmRleE9mKE1hdGgubWF4KC4uLmR1cmF0aW9uVGltZSkpO1xyXG5sZXQgZHVyYXRpb25TZXRBZGRpdGlvbmFsID0gWzI1MCwgMjUwLCAyNTBdOyAvL3RpbWUgb2YgYW5pbWF0aW9uIG9mIGFkZGl0aW9uYWwgc3RlcHMgb2Ygc3BsaXR0aW5nIGFuZCBkcmFnZ2luZyBtb2JpbGUgcGhvbmVzXHJcbmxldCBkdXJhdGlvblRpbWVCRyA9IFtdOyAvL3RpbWUgb2YgYW5pbWF0aW9uIGZvciBiZ0NvbG9yIGNoYW5nZTtcclxuZm9yIChsZXQgaSA9IDA7IGkgPCBkdXJhdGlvblRpbWUubGVuZ3RoOyBpKyspIHtcclxuICBkdXJhdGlvblRpbWVCR1tpXSA9IGR1cmF0aW9uVGltZVtpXSArIGR1cmF0aW9uU2V0QWRkaXRpb25hbFtpXSoyO1xyXG59XHJcblxyXG5sZXQgZHVyYXRpb25aZXJvID0gWzAsIDAsIDBdO1xyXG5sZXQgcG93ID0gMjsgLy9wb3dlciBvZiB0aW1pbmcgZnVuY3Rpb25cclxubGV0IGdyYWREQkEgPSB7XHJcbiAgY29sb3I6IFtbMjMxLDc4LDQ0XSwgWzI1NCwxNTYsMTAwXV0sXHJcbn1cclxubGV0IGdyYWRNdXN0YW5nID0ge1xyXG4gIGNvbG9yOiBbWzg1LDc1LDE2MV0sIFsxMDUsMTk5LDIzN11dLFxyXG59XHJcbmxldCBncmFkID0ge307XHJcbmxldCBjb21wYXJlR3JhZCA9IHt9O1xyXG5sZXQgY3VycmVudEdyYWQgPSB7XHJcbiAgY29sb3I6IFtbXSxbXV0sXHJcbn07XHJcbmxldCBjdXJyZW50UHJvZ3Jlc3M7XHJcbmxldCBzbGlkZVBob25lcyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ2NvbC1zbGlkZScpOyAvL2FuaW1hdGVkIHBob25lcyBjb2x1bW5zXHJcbmxldCBpbml0VG9wID0gW107IC8vYXJyYXkgb2YgaW5pdGlhbCB0b3AgdmFsdWVzIG9mIGNvbHVtbnNcclxubGV0IGZpbmFsVG9wID0gW107IC8vYXJyYXkgb2YgZmluYWwgdG9wIHZhbHVlcyBvZiBjb2x1bW5zXHJcbmxldCBwaG9uZUhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodCowLjY7XHJcbmxldCBjZWNpbEVsZW1zID0gW2RvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ2NvbExlZnRDZWNpbCcpLCBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdjb2xDZW50ZXJDZWNpbCcpLCBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdjb2xSaWdodENlY2lsJyldO1xyXG5sZXQgZGJhRWxlbXMgPSBbZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnY29sTGVmdERCQScpLCBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdjb2xDZW50ZXJEQkEnKSwgZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnY29sUmlnaHREQkEnKV07XHJcbmxldCBkaXN0YW5jZSA9IHdpbmRvdy5pbm5lckhlaWdodDsgLy9kaXN0YW5jZSBiZXR3ZWVuIHZpc2libGUgYW5kIGludmlzaWJsZSBtb2JpbGUgcGhvbmVzXHJcbmxldCBjdXJyZW50VG9wQ2VjaWwgPSBbXTtcclxubGV0IG5ld1RvcENlY2lsID0gW107XHJcbmxldCBjdXJyZW50VG9wREJBID0gW107XHJcbmxldCBuZXdUb3BEQkEgPSBbXTtcclxubGV0IGZpbmFsRGVzdGluYXRpb25Cb3R0b207XHJcbmxldCBmaW5hbERlc3RpbmF0aW9uVG9wO1xyXG5sZXQgc3RvcE1vdmUgPSBmYWxzZTtcclxuXHJcbi8vcmVxdWVzdEFuaW1hdGlvbkZyYW1lIGZ1bmN0aW9uXHJcbmZ1bmN0aW9uIGFuaW1hdGUoe3RpbWluZywgZHJhdywgZHVyYXRpb259KSB7XHJcbiAgbGV0IHN0YXJ0ID0gcGVyZm9ybWFuY2Uubm93KCk7XHJcbiAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGZ1bmN0aW9uIGFuaW1hdGUodGltZSkge1xyXG4gICAgLy8gdGltZUZyYWN0aW9uINC40LfQvNC10L3Rj9C10YLRgdGPINC+0YIgMCDQtNC+IDFcclxuICAgIGxldCB0aW1lRnJhY3Rpb24gPSAodGltZSAtIHN0YXJ0KSAvIChkdXJhdGlvbik7XHJcbiAgICBpZiAodGltZUZyYWN0aW9uID4gMSkgdGltZUZyYWN0aW9uID0gMTtcclxuICAgIC8vINCy0YvRh9C40YHQu9C10L3QuNC1INGC0LXQutGD0YnQtdCz0L4g0YHQvtGB0YLQvtGP0L3QuNGPINCw0L3QuNC80LDRhtC40LhcclxuICAgIGxldCBwcm9ncmVzcyA9IHRpbWluZyh0aW1lRnJhY3Rpb24pO1xyXG4gICAgZHJhdyhwcm9ncmVzcyk7IC8vINC+0YLRgNC40YHQvtCy0LDRgtGMINC10ZFcclxuICAgIGlmICh0aW1lRnJhY3Rpb24gPCAxICYmICFzdG9wTW92ZSkge1xyXG4gICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7XHJcbiAgICB9XHJcbiAgfSk7XHJcbn1cclxuXHJcbi8vYmcgYW5pbWF0aW9uXHJcbmZ1bmN0aW9uIGNoYW5nZShwYXJhbUdyYWQxLCBwYXJhbUdyYWQyLCBlbGVtZW50LCB0aW1lRHVyYXRpb25TZXQpIHtcclxuICBncmFkID0gey4uLnBhcmFtR3JhZDF9O1xyXG4gIGdyYWQuY29sb3IgPSBbLi4ucGFyYW1HcmFkMS5jb2xvcl07XHJcbiAgY29tcGFyZUdyYWQuY29sb3IgPSBbLi4ucGFyYW1HcmFkMi5jb2xvcl07XHJcbiAgY29tcGFyZUdyYWQgPSB7Li4ucGFyYW1HcmFkMn07XHJcblxyXG4gIGZvciAobGV0IGogPSAwOyBqIDwgZ3JhZC5jb2xvci5sZW5ndGg7IGorKykge1xyXG4gICAgZ3JhZC5jb2xvcltqXSA9IFsuLi5wYXJhbUdyYWQxLmNvbG9yW2pdXTtcclxuICAgIGNvbXBhcmVHcmFkLmNvbG9yW2pdID0gWy4uLnBhcmFtR3JhZDIuY29sb3Jbal1dO1xyXG4gIH1cclxuICBcclxuICBiZ0NvbG9yKGVsZW1lbnQsIHRpbWVEdXJhdGlvblNldCk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGJnQ29sb3IoZWxlbSwgc2V0RHVyYXRpb24pIHtcclxuICByZXR1cm4gYW5pbWF0ZSh7XHJcbiAgICBkdXJhdGlvbjogTWF0aC5tYXgoLi4uc2V0RHVyYXRpb24pLFxyXG4gICAgdGltaW5nOiBmdW5jdGlvbiAodGltZUZyYWN0aW9uKSB7XHJcbiAgICAgIHJldHVybiB0aW1lRnJhY3Rpb247XHJcbiAgICB9LFxyXG4gICAgZHJhdzogZnVuY3Rpb24ocHJvZ3Jlc3MpIHtcclxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAyOyBpKyspIHtcclxuICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IDM7IGorKykge1xyXG4gICAgICAgICAgY3VycmVudEdyYWQuY29sb3JbaV1bal0gPSAoZ3JhZC5jb2xvcltpXVtqXSArIChjb21wYXJlR3JhZC5jb2xvcltpXVtqXS1ncmFkLmNvbG9yW2ldW2pdKSAqIHByb2dyZXNzKTtcclxuICAgICAgICB9XHJcbiAgICAgIH07XHJcbiAgICAgIGVsZW0uc3R5bGUuYmFja2dyb3VuZEltYWdlID0gKCdsaW5lYXItZ3JhZGllbnQoMTE3ZGVnLCByZ2IoJytjdXJyZW50R3JhZC5jb2xvclswXSsnKSwgcmdiKCcrY3VycmVudEdyYWQuY29sb3JbMV0rJykpJyk7XHJcbiAgICB9XHJcbiAgfSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGN1cnJlbnRQb3MoKSB7XHJcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBzY3JvbGxFbGVtcy5sZW5ndGg7IGkrKykge1xyXG4gICAgaWYgKCh3aW5kb3cuc2Nyb2xsWSArIHdpbmRvdy5pbm5lckhlaWdodC8yKSA+PSBzY3JvbGxFbGVtc1tpXS5vZmZzZXRUb3AgJiYgKHdpbmRvdy5zY3JvbGxZICsgd2luZG93LmlubmVySGVpZ2h0LzIpIDwgc2Nyb2xsRWxlbXNbaV0ub2Zmc2V0VG9wICsgc2Nyb2xsRWxlbXNbaV0uY2xpZW50SGVpZ2h0KSB7XHJcbiAgICAgIHJldHVybiBpO1xyXG4gICAgfSAgXHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBkYmFTZWN0aW9uKCkge1xyXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgc2Nyb2xsRWxlbXMubGVuZ3RoOyBpKyspIHtcclxuICAgIGlmIChzY3JvbGxFbGVtc1tpXS5pZCA9PSBcImRiYWZpdG5lc3NcIikge1xyXG4gICAgICByZXR1cm4gaTtcclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIG11c3RhbmdTZWN0aW9uKCkge1xyXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgc2Nyb2xsRWxlbXMubGVuZ3RoOyBpKyspIHtcclxuICAgIGlmIChzY3JvbGxFbGVtc1tpXS5pZCA9PSBcIm11c3RhbmdjaGFpblwiKSB7XHJcbiAgICAgIHJldHVybiBpO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG4vL2ZvciBwaG9uZXMgYW5pbWF0aW9uXHJcbmZ1bmN0aW9uIG1vYmlsZU1vdmUoZHVyYXRpb25TZXQpIHsgXHJcbiAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXMsIHJlaikgPT4ge1xyXG4gICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IHNsaWRlUGhvbmVzLmxlbmd0aDsgaW5kZXgrKykge1xyXG4gICAgICBhbmltYXRlKHtcclxuICAgICAgICBkdXJhdGlvbjogZHVyYXRpb25TZXRbaW5kZXhdLFxyXG4gICAgICAgIHRpbWluZzogZnVuY3Rpb24gKHRpbWVGcmFjdGlvbikge1xyXG4gICAgICAgICAgcmV0dXJuIE1hdGgucG93KHRpbWVGcmFjdGlvbiwgcG93KTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGRyYXc6IGZ1bmN0aW9uKHByb2dyZXNzKSB7XHJcbiAgICAgICAgICAgIHNsaWRlUGhvbmVzW2luZGV4XS5zdHlsZS50cmFuc2Zvcm0gPSAndHJhbnNsYXRlWSgnKygoKHByb2dyZXNzICogZmluYWxUb3BBcnJheVtpbmRleF0pICsgKCgxLXByb2dyZXNzKSpzdGFydFRvcEFycmF5W2luZGV4XSkpKSsncHgpJztcclxuICAgICAgICAgICAgY3VycmVudFByb2dyZXNzW2luZGV4XSA9IChwcm9ncmVzcyAqIGZpbmFsVG9wQXJyYXlbaW5kZXhdKSArICgoMS1wcm9ncmVzcykqc3RhcnRUb3BBcnJheVtpbmRleF0pO1xyXG4gICAgICAgICAgXHJcbiAgICAgICAgICBpZiAocHJvZ3Jlc3MgPT0gMSAmJiBpbmRleCA9PSBpbmRleE9mU2xvd2VzdCkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygncmVzb2x2ZWQnKVxyXG4gICAgICAgICAgICByZXMoKTtcclxuICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9KVxyXG59XHJcblxyXG5mdW5jdGlvbiB0b3BNb3ZlKGR1cmF0aW9uU2V0KSB7XHJcbiAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXMsIHJlaikgPT4ge1xyXG4gICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IHNsaWRlUGhvbmVzLmxlbmd0aDsgaW5kZXgrKykge1xyXG4gICAgICBpZiAoIW5ld1RvcENlY2lsW2luZGV4XSkge1xyXG4gICAgICAgIG5ld1RvcENlY2lsW2luZGV4XSA9IDA7XHJcbiAgICAgIH1cclxuICAgICAgY3VycmVudFRvcENlY2lsW2luZGV4XSA9IG5ld1RvcENlY2lsW2luZGV4XTtcclxuICAgICAgaWYgKGZpbmFsRGVzdGluYXRpb25Ub3AgPT0gZGlzdGFuY2UqKC0xKSkge1xyXG4gICAgICAgIGZpbmFsRGVzdGluYXRpb25Ub3AgPSBkaXN0YW5jZSooLTEpXHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgZmluYWxEZXN0aW5hdGlvblRvcCA9IDBcclxuICAgICAgfVxyXG5cclxuICAgICAgYW5pbWF0ZSh7XHJcbiAgICAgICAgZHVyYXRpb246IGR1cmF0aW9uU2V0W2luZGV4XSxcclxuICAgICAgICB0aW1pbmc6IGZ1bmN0aW9uICh0aW1lRnJhY3Rpb24pIHtcclxuICAgICAgICAgIHJldHVybiBNYXRoLnBvdyh0aW1lRnJhY3Rpb24sIHBvdylcclxuICAgICAgICB9LFxyXG4gICAgICAgIGRyYXc6IGZ1bmN0aW9uKHByb2dyZXNzKSB7XHJcbiAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNlY2lsRWxlbXNbaW5kZXhdLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGNlY2lsRWxlbXNbaW5kZXhdW2ldLnN0eWxlLnRyYW5zZm9ybSA9ICd0cmFuc2xhdGVZKCcrKCgxLXByb2dyZXNzKSpjdXJyZW50VG9wQ2VjaWxbaW5kZXhdICsgcHJvZ3Jlc3MqKGZpbmFsRGVzdGluYXRpb25Ub3ApKSsncHgpJztcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIG5ld1RvcENlY2lsW2luZGV4XSA9ICgxLXByb2dyZXNzKSpjdXJyZW50VG9wQ2VjaWxbaW5kZXhdICsgcHJvZ3Jlc3MqKGZpbmFsRGVzdGluYXRpb25Ub3ApO1xyXG4gICAgXHJcbiAgICAgICAgICBpZiAocHJvZ3Jlc3MgPT0gMSAmJiBpbmRleCA9PSBpbmRleE9mU2xvd2VzdCkge1xyXG4gICAgICAgICAgICByZXMoKTtcclxuICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9KVxyXG59XHJcblxyXG5mdW5jdGlvbiBib3R0b21Nb3ZlKGR1cmF0aW9uU2V0KSB7XHJcbiAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXMsIHJlaikgPT4ge1xyXG4gICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IHNsaWRlUGhvbmVzLmxlbmd0aDsgaW5kZXgrKykge1xyXG4gICAgICBpZiAoIW5ld1RvcERCQVtpbmRleF0pIHtcclxuICAgICAgICBuZXdUb3BEQkFbaW5kZXhdID0gMDtcclxuICAgICAgfVxyXG4gICAgICBjdXJyZW50VG9wREJBW2luZGV4XSA9IG5ld1RvcERCQVtpbmRleF07XHJcbiAgICAgIGlmIChmaW5hbERlc3RpbmF0aW9uQm90dG9tID09IGRpc3RhbmNlKSB7XHJcbiAgICAgICAgZmluYWxEZXN0aW5hdGlvbkJvdHRvbSA9IGRpc3RhbmNlXHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgZmluYWxEZXN0aW5hdGlvbkJvdHRvbSA9IDBcclxuICAgICAgfVxyXG5cclxuICAgICAgYW5pbWF0ZSh7XHJcbiAgICAgICAgZHVyYXRpb246IGR1cmF0aW9uU2V0W2luZGV4XSxcclxuICAgICAgICB0aW1pbmc6IGZ1bmN0aW9uICh0aW1lRnJhY3Rpb24pIHtcclxuICAgICAgICAgIHJldHVybiBNYXRoLnBvdyh0aW1lRnJhY3Rpb24sIHBvdylcclxuICAgICAgICB9LFxyXG4gICAgICAgIGRyYXc6IGZ1bmN0aW9uKHByb2dyZXNzKSB7XHJcbiAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGRiYUVsZW1zW2luZGV4XS5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICBkYmFFbGVtc1tpbmRleF1baV0uc3R5bGUudHJhbnNmb3JtID0gJ3RyYW5zbGF0ZVkoJysoKDEtcHJvZ3Jlc3MpKmN1cnJlbnRUb3BEQkFbaW5kZXhdICsgcHJvZ3Jlc3MqKGZpbmFsRGVzdGluYXRpb25Cb3R0b20pKSsncHgpJztcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIG5ld1RvcERCQVtpbmRleF0gPSAoMS1wcm9ncmVzcykqY3VycmVudFRvcERCQVtpbmRleF0gKyBwcm9ncmVzcyooZmluYWxEZXN0aW5hdGlvbkJvdHRvbSk7XHJcblxyXG4gICAgICAgICAgaWYgKHByb2dyZXNzID09IDEgJiYgaW5kZXggPT0gaW5kZXhPZlNsb3dlc3QpIHtcclxuICAgICAgICAgICAgcmVzKCk7XHJcbiAgICAgICAgICB9O1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfSlcclxufVxyXG4vL2VuZFxyXG5cclxuLy9leGVjdXRpbmdcclxud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJsb2FkXCIsIGZ1bmN0aW9uKCl7XHJcbiAgbGV0IHNoaWZ0VG9wID0gWzAsIHdpbmRvdy5pbm5lckhlaWdodCowLjIyLCB3aW5kb3cuaW5uZXJIZWlnaHQqMC4wMl07XHJcbiAgbGV0IHNoaWZ0Qm90dG9tID0gW3dpbmRvdy5pbm5lckhlaWdodCowLjQsIHdpbmRvdy5pbm5lckhlaWdodCowLjIyLCBwaG9uZUhlaWdodCoyXVxyXG5cclxuICBmb3IgKGxldCBpID0gMDsgaSA8IHNsaWRlUGhvbmVzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICBpbml0VG9wW2ldID0gc2xpZGVQaG9uZXNbaV0ub2Zmc2V0VG9wICsgc2hpZnRUb3BbaV07XHJcbiAgfVxyXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgc2xpZGVQaG9uZXMubGVuZ3RoOyBpKyspIHtcclxuICAgIGZpbmFsVG9wW2ldID0gKGluaXRUb3BbaV0gKyA1LjMqcGhvbmVIZWlnaHQgLSBzaGlmdFRvcFtpXSAtIHNoaWZ0Qm90dG9tW2ldKTtcclxuICB9XHJcblxyXG4gIGlmIChjdXJyZW50UG9zKCkgPiBkYmFTZWN0aW9uKCkpIHtcclxuICAgIGZpcnN0RW50ZXJNdXN0YW5nID0gZmFsc2U7XHJcbiAgICBmaXJzdEVudGVyREJBID0gdHJ1ZTtcclxuICAgIG5ld1RvcERCQSA9IFswLCAwLCAwXTtcclxuICAgIGZpbmFsRGVzdGluYXRpb25Cb3R0b20gPSBkaXN0YW5jZTtcclxuICAgIG5ld1RvcENlY2lsID0gWygtMSkqZGlzdGFuY2UsICgtMSkqZGlzdGFuY2UsICgtMSkqZGlzdGFuY2VdO1xyXG4gICAgZmluYWxEZXN0aW5hdGlvblRvcCA9IDA7XHJcbiAgICBjdXJyZW50UHJvZ3Jlc3MgPSBbLi4uaW5pdFRvcF07XHJcbiAgICBmaW5hbFRvcEFycmF5ID0gWy4uLmZpbmFsVG9wXTtcclxuICAgIHN0YXJ0VG9wQXJyYXkgPSBbLi4uY3VycmVudFByb2dyZXNzXTtcclxuICAgIFxyXG4gICAgY2hhbmdlKGdyYWREQkEsIGdyYWRNdXN0YW5nLCBhcnRpY2xlLCBkdXJhdGlvblplcm8pO1xyXG4gICAgdG9wTW92ZShkdXJhdGlvblplcm8pXHJcbiAgICAgIC50aGVuKCgpID0+IG1vYmlsZU1vdmUoZHVyYXRpb25aZXJvKSlcclxuICAgICAgLnRoZW4oKCkgPT4gYm90dG9tTW92ZShkdXJhdGlvblplcm8pKVxyXG5cclxuICB9IGVsc2Uge1xyXG4gICAgZmlyc3RFbnRlckRCQSA9IGZhbHNlO1xyXG4gICAgZmlyc3RFbnRlck11c3RhbmcgPSB0cnVlO1xyXG4gICAgbmV3VG9wREJBID0gW2Rpc3RhbmNlLCBkaXN0YW5jZSwgZGlzdGFuY2VdO1xyXG4gICAgZmluYWxEZXN0aW5hdGlvbkJvdHRvbSA9IDA7XHJcbiAgICBuZXdUb3BDZWNpbCA9IFswLCAwLCAwXTtcclxuICAgIGZpbmFsRGVzdGluYXRpb25Ub3AgPSAoLTEpKmRpc3RhbmNlO1xyXG4gICAgY3VycmVudFByb2dyZXNzID0gWy4uLmZpbmFsVG9wXTtcclxuICAgIGZpbmFsVG9wQXJyYXkgPSBbLi4uaW5pdFRvcF07XHJcbiAgICBzdGFydFRvcEFycmF5ID0gWy4uLmN1cnJlbnRQcm9ncmVzc107XHJcblxyXG4gICAgY2hhbmdlKGdyYWRNdXN0YW5nLCBncmFkREJBLCBhcnRpY2xlLCBkdXJhdGlvblplcm8pO1xyXG4gICAgYm90dG9tTW92ZShkdXJhdGlvblplcm8pXHJcbiAgICAgIC50aGVuKCgpID0+IG1vYmlsZU1vdmUoZHVyYXRpb25aZXJvKSlcclxuICAgICAgLnRoZW4oKCkgPT4gdG9wTW92ZShkdXJhdGlvblplcm8pKVxyXG4gIH1cclxuICBcclxuICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwic2Nyb2xsXCIsIGZ1bmN0aW9uKGV2ZW50KSB7XHJcblxyXG4gICAgaWYgKGN1cnJlbnRQb3MoKSA9PSBkYmFTZWN0aW9uKCkgJiYgZmlyc3RFbnRlckRCQSA9PSB0cnVlKSB7XHJcbiAgICAgIGxldCBwcm9taXNlREJBID0gbmV3IFByb21pc2UoKHJlcywgcmVqKSA9PiB7XHJcbiAgICAgICAgc3RvcE1vdmUgPSB0cnVlO1xyXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgcmVzKCk7XHJcbiAgICAgICAgfSwgMClcclxuICAgICAgfSk7XHJcbiAgICAgIHByb21pc2VEQkEudGhlbigoKSA9PiB7XHJcbiAgICAgICAgc3RvcE1vdmUgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgZmluYWxEZXN0aW5hdGlvbkJvdHRvbSA9IDA7XHJcbiAgICAgICAgZmluYWxEZXN0aW5hdGlvblRvcCA9ICgtMSkqZGlzdGFuY2U7XHJcbiAgICAgICAgZmluYWxUb3BBcnJheSA9IFsuLi5pbml0VG9wXTtcclxuICAgICAgICBzdGFydFRvcEFycmF5ID0gWy4uLmN1cnJlbnRQcm9ncmVzc107XHJcblxyXG4gICAgICAgIGNoYW5nZShjdXJyZW50R3JhZCwgZ3JhZERCQSwgYXJ0aWNsZSwgZHVyYXRpb25UaW1lQkcpO1xyXG4gICAgICAgIGJvdHRvbU1vdmUoZHVyYXRpb25TZXRBZGRpdGlvbmFsKVxyXG4gICAgICAgICAgLnRoZW4oKCkgPT4gbW9iaWxlTW92ZShkdXJhdGlvblRpbWUpKVxyXG4gICAgICAgICAgLnRoZW4oKCkgPT4gdG9wTW92ZShkdXJhdGlvblNldEFkZGl0aW9uYWwpKVxyXG4gICAgICB9KTtcclxuICAgICAgXHJcbiAgICAgIGZpcnN0RW50ZXJEQkEgPSBmYWxzZTtcclxuICAgICAgZmlyc3RFbnRlck11c3RhbmcgPSB0cnVlO1xyXG5cclxuICAgIH0gZWxzZSBpZiAoY3VycmVudFBvcygpID09IG11c3RhbmdTZWN0aW9uKCkgJiYgZmlyc3RFbnRlck11c3RhbmcgPT0gdHJ1ZSkge1xyXG4gICAgICBsZXQgcHJvbWlzZU11c3RhbmcgPSBuZXcgUHJvbWlzZSgocmVzLCByZWopID0+IHtcclxuICAgICAgICBzdG9wTW92ZSA9IHRydWU7XHJcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICByZXMoKTtcclxuICAgICAgICB9LCAwKVxyXG4gICAgICB9KTtcclxuICAgICAgcHJvbWlzZU11c3RhbmcudGhlbigoKSA9PiB7XHJcbiAgICAgICAgc3RvcE1vdmUgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgZmluYWxEZXN0aW5hdGlvblRvcCA9IDA7XHJcbiAgICAgICAgc3RhcnRUb3BBcnJheSA9IFsuLi5jdXJyZW50UHJvZ3Jlc3NdO1xyXG4gICAgICAgIGZpbmFsVG9wQXJyYXkgPSBbLi4uZmluYWxUb3BdO1xyXG4gICAgICAgIGZpbmFsRGVzdGluYXRpb25Cb3R0b20gPSBkaXN0YW5jZTtcclxuXHJcbiAgICAgICAgY2hhbmdlKGN1cnJlbnRHcmFkLCBncmFkTXVzdGFuZywgYXJ0aWNsZSwgZHVyYXRpb25UaW1lQkcpO1xyXG4gICAgICAgIHRvcE1vdmUoZHVyYXRpb25TZXRBZGRpdGlvbmFsKVxyXG4gICAgICAgICAgLnRoZW4oKCkgPT4gbW9iaWxlTW92ZShkdXJhdGlvblRpbWUpKVxyXG4gICAgICAgICAgLnRoZW4oKCkgPT4gYm90dG9tTW92ZShkdXJhdGlvblNldEFkZGl0aW9uYWwpKVxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGZpcnN0RW50ZXJNdXN0YW5nID0gZmFsc2U7XHJcbiAgICAgIGZpcnN0RW50ZXJEQkEgPSB0cnVlO1xyXG4gICAgfVxyXG4gIH0pO1xyXG5cclxufSk7Il0sImZpbGUiOiJtYWluLmpzIn0=
