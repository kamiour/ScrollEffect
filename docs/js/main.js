let scrollElems=document.getElementsByClassName("scrollPage"),article=document.querySelector(".article"),durationTime=[400,600,800],indexOfSlowest=durationTime.indexOf(Math.max(...durationTime)),durationSetAdditional=[250,250,250],durationTimeBG=[];for(let i=0;i<durationTime.length;i++)durationTimeBG[i]=durationTime[i]+2*durationSetAdditional[i];let currentProgress,finalDestinationBottom,finalDestinationTop,durationZero=[0,0,0],pow=2,gradDBA={color:[[231,78,44],[254,156,100]]},gradMustang={color:[[85,75,161],[105,199,237]]},grad={},compareGrad={},currentGrad={color:[[],[]]},slidePhones=document.getElementsByClassName("col-slide"),initTop=[],finalTop=[],phoneHeight=.6*window.innerHeight,cecilElems=[document.getElementsByClassName("colLeftCecil"),document.getElementsByClassName("colCenterCecil"),document.getElementsByClassName("colRightCecil")],dbaElems=[document.getElementsByClassName("colLeftDBA"),document.getElementsByClassName("colCenterDBA"),document.getElementsByClassName("colRightDBA")],distance=window.innerHeight,currentTopCecil=[],newTopCecil=[],currentTopDBA=[],newTopDBA=[],stopMove=!1;function animate({timing,draw,duration}){let start=performance.now();requestAnimationFrame(function animate(time){let timeFraction=(time-start)/duration;timeFraction>1&&(timeFraction=1);let progress=timing(timeFraction);draw(progress),timeFraction<1&&!stopMove&&requestAnimationFrame(animate)})}function change(paramGrad1,paramGrad2,element,timeDurationSet){(grad={...paramGrad1}).color=[...paramGrad1.color],compareGrad.color=[...paramGrad2.color],compareGrad={...paramGrad2};for(let j=0;j<grad.color.length;j++)grad.color[j]=[...paramGrad1.color[j]],compareGrad.color[j]=[...paramGrad2.color[j]];bgColor(element,timeDurationSet)}function bgColor(elem,setDuration){return animate({duration:Math.max(...setDuration),timing:function(timeFraction){return timeFraction},draw:function(progress){for(let i=0;i<2;i++)for(let j=0;j<3;j++)currentGrad.color[i][j]=grad.color[i][j]+(compareGrad.color[i][j]-grad.color[i][j])*progress;elem.style.backgroundImage="linear-gradient(117deg, rgb("+currentGrad.color[0]+"), rgb("+currentGrad.color[1]+"))"}})}function currentPos(){for(let i=0;i<scrollElems.length;i++)if(window.scrollY+window.innerHeight/2>=scrollElems[i].offsetTop&&window.scrollY+window.innerHeight/2<scrollElems[i].offsetTop+scrollElems[i].clientHeight)return i}function dbaSection(){for(let i=0;i<scrollElems.length;i++)if("dbafitness"==scrollElems[i].id)return i}function mustangSection(){for(let i=0;i<scrollElems.length;i++)if("mustangchain"==scrollElems[i].id)return i}function mobileMove(durationSet){return new Promise((res,rej)=>{for(let index=0;index<slidePhones.length;index++)animate({duration:durationSet[index],timing:function(timeFraction){return Math.pow(timeFraction,pow)},draw:function(progress){slidePhones[index].style.transform="translateY("+(progress*finalTopArray[index]+(1-progress)*startTopArray[index])+"px)",currentProgress[index]=progress*finalTopArray[index]+(1-progress)*startTopArray[index],1==progress&&index==indexOfSlowest&&(console.log("resolved"),res())}})})}function topMove(durationSet){return new Promise((res,rej)=>{for(let index=0;index<slidePhones.length;index++)newTopCecil[index]||(newTopCecil[index]=0),currentTopCecil[index]=newTopCecil[index],finalDestinationTop=finalDestinationTop==-1*distance?-1*distance:0,animate({duration:durationSet[index],timing:function(timeFraction){return Math.pow(timeFraction,pow)},draw:function(progress){for(let i=0;i<cecilElems[index].length;i++)cecilElems[index][i].style.transform="translateY("+((1-progress)*currentTopCecil[index]+progress*finalDestinationTop)+"px)";newTopCecil[index]=(1-progress)*currentTopCecil[index]+progress*finalDestinationTop,1==progress&&index==indexOfSlowest&&res()}})})}function bottomMove(durationSet){return new Promise((res,rej)=>{for(let index=0;index<slidePhones.length;index++)newTopDBA[index]||(newTopDBA[index]=0),currentTopDBA[index]=newTopDBA[index],finalDestinationBottom=finalDestinationBottom==distance?distance:0,animate({duration:durationSet[index],timing:function(timeFraction){return Math.pow(timeFraction,pow)},draw:function(progress){for(let i=0;i<dbaElems[index].length;i++)dbaElems[index][i].style.transform="translateY("+((1-progress)*currentTopDBA[index]+progress*finalDestinationBottom)+"px)";newTopDBA[index]=(1-progress)*currentTopDBA[index]+progress*finalDestinationBottom,1==progress&&index==indexOfSlowest&&res()}})})}window.addEventListener("load",function(){let shiftTop=[0,.22*window.innerHeight,.02*window.innerHeight],shiftBottom=[.4*window.innerHeight,.22*window.innerHeight,2*phoneHeight];for(let i=0;i<slidePhones.length;i++)initTop[i]=slidePhones[i].offsetTop+shiftTop[i];for(let i=0;i<slidePhones.length;i++)finalTop[i]=initTop[i]+5.3*phoneHeight-shiftTop[i]-shiftBottom[i];currentPos()>dbaSection()?(firstEnterMustang=!1,firstEnterDBA=!0,newTopDBA=[0,0,0],finalDestinationBottom=distance,newTopCecil=[-1*distance,-1*distance,-1*distance],finalDestinationTop=0,currentProgress=[...initTop],finalTopArray=[...finalTop],startTopArray=[...currentProgress],change(gradDBA,gradMustang,article,durationZero),topMove(durationZero).then(()=>mobileMove(durationZero)).then(()=>bottomMove(durationZero))):(firstEnterDBA=!1,firstEnterMustang=!0,newTopDBA=[distance,distance,distance],finalDestinationBottom=0,newTopCecil=[0,0,0],finalDestinationTop=-1*distance,currentProgress=[...finalTop],finalTopArray=[...initTop],startTopArray=[...currentProgress],change(gradMustang,gradDBA,article,durationZero),bottomMove(durationZero).then(()=>mobileMove(durationZero)).then(()=>topMove(durationZero))),document.addEventListener("scroll",function(event){if(currentPos()==dbaSection()&&1==firstEnterDBA){new Promise((res,rej)=>{stopMove=!0,setTimeout(()=>{res()},0)}).then(()=>{stopMove=!1,finalDestinationBottom=0,finalDestinationTop=-1*distance,finalTopArray=[...initTop],startTopArray=[...currentProgress],change(currentGrad,gradDBA,article,durationTimeBG),bottomMove(durationSetAdditional).then(()=>mobileMove(durationTime)).then(()=>topMove(durationSetAdditional))}),firstEnterDBA=!1,firstEnterMustang=!0}else if(currentPos()==mustangSection()&&1==firstEnterMustang){new Promise((res,rej)=>{stopMove=!0,setTimeout(()=>{res()},0)}).then(()=>{stopMove=!1,finalDestinationTop=0,startTopArray=[...currentProgress],finalTopArray=[...finalTop],finalDestinationBottom=distance,change(currentGrad,gradMustang,article,durationTimeBG),topMove(durationSetAdditional).then(()=>mobileMove(durationTime)).then(()=>bottomMove(durationSetAdditional))}),firstEnterMustang=!1,firstEnterDBA=!0}})});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiIiwic291cmNlcyI6WyJtYWluLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIFZhcmlhYmxlc1xubGV0IHNjcm9sbEVsZW1zID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnc2Nyb2xsUGFnZScpO1xubGV0IGFydGljbGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYXJ0aWNsZScpO1xubGV0IGR1cmF0aW9uVGltZSA9IFs0MDAsIDYwMCwgODAwXTsgLy90aW1lIG9mIGFuaW1hdGlvbiBkdXJhdGlvbiBmb3IgbW9iaWxlXG5sZXQgaW5kZXhPZlNsb3dlc3QgPSBkdXJhdGlvblRpbWUuaW5kZXhPZihNYXRoLm1heCguLi5kdXJhdGlvblRpbWUpKTtcbmxldCBkdXJhdGlvblNldEFkZGl0aW9uYWwgPSBbMjUwLCAyNTAsIDI1MF07IC8vdGltZSBvZiBhbmltYXRpb24gb2YgYWRkaXRpb25hbCBzdGVwcyBvZiBzcGxpdHRpbmcgYW5kIGRyYWdnaW5nIG1vYmlsZSBwaG9uZXNcbmxldCBkdXJhdGlvblRpbWVCRyA9IFtdOyAvL3RpbWUgb2YgYW5pbWF0aW9uIGZvciBiZ0NvbG9yIGNoYW5nZTtcbmZvciAobGV0IGkgPSAwOyBpIDwgZHVyYXRpb25UaW1lLmxlbmd0aDsgaSsrKSB7XG4gIGR1cmF0aW9uVGltZUJHW2ldID0gZHVyYXRpb25UaW1lW2ldICsgZHVyYXRpb25TZXRBZGRpdGlvbmFsW2ldKjI7XG59XG5cbmxldCBkdXJhdGlvblplcm8gPSBbMCwgMCwgMF07XG5sZXQgcG93ID0gMjsgLy9wb3dlciBvZiB0aW1pbmcgZnVuY3Rpb25cbmxldCBncmFkREJBID0ge1xuICBjb2xvcjogW1syMzEsNzgsNDRdLCBbMjU0LDE1NiwxMDBdXSxcbn1cbmxldCBncmFkTXVzdGFuZyA9IHtcbiAgY29sb3I6IFtbODUsNzUsMTYxXSwgWzEwNSwxOTksMjM3XV0sXG59XG5sZXQgZ3JhZCA9IHt9O1xubGV0IGNvbXBhcmVHcmFkID0ge307XG5sZXQgY3VycmVudEdyYWQgPSB7XG4gIGNvbG9yOiBbW10sW11dLFxufTtcbmxldCBjdXJyZW50UHJvZ3Jlc3M7XG5sZXQgc2xpZGVQaG9uZXMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdjb2wtc2xpZGUnKTsgLy9hbmltYXRlZCBwaG9uZXMgY29sdW1uc1xubGV0IGluaXRUb3AgPSBbXTsgLy9hcnJheSBvZiBpbml0aWFsIHRvcCB2YWx1ZXMgb2YgY29sdW1uc1xubGV0IGZpbmFsVG9wID0gW107IC8vYXJyYXkgb2YgZmluYWwgdG9wIHZhbHVlcyBvZiBjb2x1bW5zXG5sZXQgcGhvbmVIZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQqMC42O1xubGV0IGNlY2lsRWxlbXMgPSBbZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnY29sTGVmdENlY2lsJyksIGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ2NvbENlbnRlckNlY2lsJyksIGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ2NvbFJpZ2h0Q2VjaWwnKV07XG5sZXQgZGJhRWxlbXMgPSBbZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnY29sTGVmdERCQScpLCBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdjb2xDZW50ZXJEQkEnKSwgZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnY29sUmlnaHREQkEnKV07XG5sZXQgZGlzdGFuY2UgPSB3aW5kb3cuaW5uZXJIZWlnaHQ7IC8vZGlzdGFuY2UgYmV0d2VlbiB2aXNpYmxlIGFuZCBpbnZpc2libGUgbW9iaWxlIHBob25lc1xubGV0IGN1cnJlbnRUb3BDZWNpbCA9IFtdO1xubGV0IG5ld1RvcENlY2lsID0gW107XG5sZXQgY3VycmVudFRvcERCQSA9IFtdO1xubGV0IG5ld1RvcERCQSA9IFtdO1xubGV0IGZpbmFsRGVzdGluYXRpb25Cb3R0b207XG5sZXQgZmluYWxEZXN0aW5hdGlvblRvcDtcbmxldCBzdG9wTW92ZSA9IGZhbHNlO1xuXG4vL3JlcXVlc3RBbmltYXRpb25GcmFtZSBmdW5jdGlvblxuZnVuY3Rpb24gYW5pbWF0ZSh7dGltaW5nLCBkcmF3LCBkdXJhdGlvbn0pIHtcbiAgbGV0IHN0YXJ0ID0gcGVyZm9ybWFuY2Uubm93KCk7XG4gIHJlcXVlc3RBbmltYXRpb25GcmFtZShmdW5jdGlvbiBhbmltYXRlKHRpbWUpIHtcbiAgICAvLyB0aW1lRnJhY3Rpb24g0LjQt9C80LXQvdGP0LXRgtGB0Y8g0L7RgiAwINC00L4gMVxuICAgIGxldCB0aW1lRnJhY3Rpb24gPSAodGltZSAtIHN0YXJ0KSAvIChkdXJhdGlvbik7XG4gICAgaWYgKHRpbWVGcmFjdGlvbiA+IDEpIHRpbWVGcmFjdGlvbiA9IDE7XG4gICAgLy8g0LLRi9GH0LjRgdC70LXQvdC40LUg0YLQtdC60YPRidC10LPQviDRgdC+0YHRgtC+0Y/QvdC40Y8g0LDQvdC40LzQsNGG0LjQuFxuICAgIGxldCBwcm9ncmVzcyA9IHRpbWluZyh0aW1lRnJhY3Rpb24pO1xuICAgIGRyYXcocHJvZ3Jlc3MpOyAvLyDQvtGC0YDQuNGB0L7QstCw0YLRjCDQtdGRXG4gICAgaWYgKHRpbWVGcmFjdGlvbiA8IDEgJiYgIXN0b3BNb3ZlKSB7XG4gICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7XG4gICAgfVxuICB9KTtcbn1cblxuLy9iZyBhbmltYXRpb25cbmZ1bmN0aW9uIGNoYW5nZShwYXJhbUdyYWQxLCBwYXJhbUdyYWQyLCBlbGVtZW50LCB0aW1lRHVyYXRpb25TZXQpIHtcbiAgZ3JhZCA9IHsuLi5wYXJhbUdyYWQxfTtcbiAgZ3JhZC5jb2xvciA9IFsuLi5wYXJhbUdyYWQxLmNvbG9yXTtcbiAgY29tcGFyZUdyYWQuY29sb3IgPSBbLi4ucGFyYW1HcmFkMi5jb2xvcl07XG4gIGNvbXBhcmVHcmFkID0gey4uLnBhcmFtR3JhZDJ9O1xuXG4gIGZvciAobGV0IGogPSAwOyBqIDwgZ3JhZC5jb2xvci5sZW5ndGg7IGorKykge1xuICAgIGdyYWQuY29sb3Jbal0gPSBbLi4ucGFyYW1HcmFkMS5jb2xvcltqXV07XG4gICAgY29tcGFyZUdyYWQuY29sb3Jbal0gPSBbLi4ucGFyYW1HcmFkMi5jb2xvcltqXV07XG4gIH1cbiAgXG4gIGJnQ29sb3IoZWxlbWVudCwgdGltZUR1cmF0aW9uU2V0KTtcbn1cblxuZnVuY3Rpb24gYmdDb2xvcihlbGVtLCBzZXREdXJhdGlvbikge1xuICByZXR1cm4gYW5pbWF0ZSh7XG4gICAgZHVyYXRpb246IE1hdGgubWF4KC4uLnNldER1cmF0aW9uKSxcbiAgICB0aW1pbmc6IGZ1bmN0aW9uICh0aW1lRnJhY3Rpb24pIHtcbiAgICAgIHJldHVybiB0aW1lRnJhY3Rpb247XG4gICAgfSxcbiAgICBkcmF3OiBmdW5jdGlvbihwcm9ncmVzcykge1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAyOyBpKyspIHtcbiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCAzOyBqKyspIHtcbiAgICAgICAgICBjdXJyZW50R3JhZC5jb2xvcltpXVtqXSA9IChncmFkLmNvbG9yW2ldW2pdICsgKGNvbXBhcmVHcmFkLmNvbG9yW2ldW2pdLWdyYWQuY29sb3JbaV1bal0pICogcHJvZ3Jlc3MpO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgZWxlbS5zdHlsZS5iYWNrZ3JvdW5kSW1hZ2UgPSAoJ2xpbmVhci1ncmFkaWVudCgxMTdkZWcsIHJnYignK2N1cnJlbnRHcmFkLmNvbG9yWzBdKycpLCByZ2IoJytjdXJyZW50R3JhZC5jb2xvclsxXSsnKSknKTtcbiAgICB9XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBjdXJyZW50UG9zKCkge1xuICBmb3IgKGxldCBpID0gMDsgaSA8IHNjcm9sbEVsZW1zLmxlbmd0aDsgaSsrKSB7XG4gICAgaWYgKCh3aW5kb3cuc2Nyb2xsWSArIHdpbmRvdy5pbm5lckhlaWdodC8yKSA+PSBzY3JvbGxFbGVtc1tpXS5vZmZzZXRUb3AgJiYgKHdpbmRvdy5zY3JvbGxZICsgd2luZG93LmlubmVySGVpZ2h0LzIpIDwgc2Nyb2xsRWxlbXNbaV0ub2Zmc2V0VG9wICsgc2Nyb2xsRWxlbXNbaV0uY2xpZW50SGVpZ2h0KSB7XG4gICAgICByZXR1cm4gaTtcbiAgICB9ICBcbiAgfVxufVxuXG5mdW5jdGlvbiBkYmFTZWN0aW9uKCkge1xuICBmb3IgKGxldCBpID0gMDsgaSA8IHNjcm9sbEVsZW1zLmxlbmd0aDsgaSsrKSB7XG4gICAgaWYgKHNjcm9sbEVsZW1zW2ldLmlkID09IFwiZGJhZml0bmVzc1wiKSB7XG4gICAgICByZXR1cm4gaTtcbiAgICB9XG4gIH1cbn1cblxuZnVuY3Rpb24gbXVzdGFuZ1NlY3Rpb24oKSB7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgc2Nyb2xsRWxlbXMubGVuZ3RoOyBpKyspIHtcbiAgICBpZiAoc2Nyb2xsRWxlbXNbaV0uaWQgPT0gXCJtdXN0YW5nY2hhaW5cIikge1xuICAgICAgcmV0dXJuIGk7XG4gICAgfVxuICB9XG59XG4vL2ZvciBwaG9uZXMgYW5pbWF0aW9uXG5mdW5jdGlvbiBtb2JpbGVNb3ZlKGR1cmF0aW9uU2V0KSB7IFxuICByZXR1cm4gbmV3IFByb21pc2UoKHJlcywgcmVqKSA9PiB7XG4gICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IHNsaWRlUGhvbmVzLmxlbmd0aDsgaW5kZXgrKykge1xuICAgICAgYW5pbWF0ZSh7XG4gICAgICAgIGR1cmF0aW9uOiBkdXJhdGlvblNldFtpbmRleF0sXG4gICAgICAgIHRpbWluZzogZnVuY3Rpb24gKHRpbWVGcmFjdGlvbikge1xuICAgICAgICAgIHJldHVybiBNYXRoLnBvdyh0aW1lRnJhY3Rpb24sIHBvdyk7XG4gICAgICAgIH0sXG4gICAgICAgIGRyYXc6IGZ1bmN0aW9uKHByb2dyZXNzKSB7XG4gICAgICAgICAgICBzbGlkZVBob25lc1tpbmRleF0uc3R5bGUudHJhbnNmb3JtID0gJ3RyYW5zbGF0ZVkoJysoKChwcm9ncmVzcyAqIGZpbmFsVG9wQXJyYXlbaW5kZXhdKSArICgoMS1wcm9ncmVzcykqc3RhcnRUb3BBcnJheVtpbmRleF0pKSkrJ3B4KSc7XG4gICAgICAgICAgICBjdXJyZW50UHJvZ3Jlc3NbaW5kZXhdID0gKHByb2dyZXNzICogZmluYWxUb3BBcnJheVtpbmRleF0pICsgKCgxLXByb2dyZXNzKSpzdGFydFRvcEFycmF5W2luZGV4XSk7XG4gICAgICAgICAgXG4gICAgICAgICAgaWYgKHByb2dyZXNzID09IDEgJiYgaW5kZXggPT0gaW5kZXhPZlNsb3dlc3QpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdyZXNvbHZlZCcpXG4gICAgICAgICAgICByZXMoKTtcbiAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gIH0pXG59XG5cbmZ1bmN0aW9uIHRvcE1vdmUoZHVyYXRpb25TZXQpIHtcbiAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXMsIHJlaikgPT4ge1xuICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCBzbGlkZVBob25lcy5sZW5ndGg7IGluZGV4KyspIHtcbiAgICAgIGlmICghbmV3VG9wQ2VjaWxbaW5kZXhdKSB7XG4gICAgICAgIG5ld1RvcENlY2lsW2luZGV4XSA9IDA7XG4gICAgICB9XG4gICAgICBjdXJyZW50VG9wQ2VjaWxbaW5kZXhdID0gbmV3VG9wQ2VjaWxbaW5kZXhdO1xuICAgICAgaWYgKGZpbmFsRGVzdGluYXRpb25Ub3AgPT0gZGlzdGFuY2UqKC0xKSkge1xuICAgICAgICBmaW5hbERlc3RpbmF0aW9uVG9wID0gZGlzdGFuY2UqKC0xKVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZmluYWxEZXN0aW5hdGlvblRvcCA9IDBcbiAgICAgIH1cblxuICAgICAgYW5pbWF0ZSh7XG4gICAgICAgIGR1cmF0aW9uOiBkdXJhdGlvblNldFtpbmRleF0sXG4gICAgICAgIHRpbWluZzogZnVuY3Rpb24gKHRpbWVGcmFjdGlvbikge1xuICAgICAgICAgIHJldHVybiBNYXRoLnBvdyh0aW1lRnJhY3Rpb24sIHBvdylcbiAgICAgICAgfSxcbiAgICAgICAgZHJhdzogZnVuY3Rpb24ocHJvZ3Jlc3MpIHtcbiAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNlY2lsRWxlbXNbaW5kZXhdLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBjZWNpbEVsZW1zW2luZGV4XVtpXS5zdHlsZS50cmFuc2Zvcm0gPSAndHJhbnNsYXRlWSgnKygoMS1wcm9ncmVzcykqY3VycmVudFRvcENlY2lsW2luZGV4XSArIHByb2dyZXNzKihmaW5hbERlc3RpbmF0aW9uVG9wKSkrJ3B4KSc7XG4gICAgICAgICAgfVxuICAgICAgICAgIG5ld1RvcENlY2lsW2luZGV4XSA9ICgxLXByb2dyZXNzKSpjdXJyZW50VG9wQ2VjaWxbaW5kZXhdICsgcHJvZ3Jlc3MqKGZpbmFsRGVzdGluYXRpb25Ub3ApO1xuICAgIFxuICAgICAgICAgIGlmIChwcm9ncmVzcyA9PSAxICYmIGluZGV4ID09IGluZGV4T2ZTbG93ZXN0KSB7XG4gICAgICAgICAgICByZXMoKTtcbiAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gIH0pXG59XG5cbmZ1bmN0aW9uIGJvdHRvbU1vdmUoZHVyYXRpb25TZXQpIHtcbiAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXMsIHJlaikgPT4ge1xuICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCBzbGlkZVBob25lcy5sZW5ndGg7IGluZGV4KyspIHtcbiAgICAgIGlmICghbmV3VG9wREJBW2luZGV4XSkge1xuICAgICAgICBuZXdUb3BEQkFbaW5kZXhdID0gMDtcbiAgICAgIH1cbiAgICAgIGN1cnJlbnRUb3BEQkFbaW5kZXhdID0gbmV3VG9wREJBW2luZGV4XTtcbiAgICAgIGlmIChmaW5hbERlc3RpbmF0aW9uQm90dG9tID09IGRpc3RhbmNlKSB7XG4gICAgICAgIGZpbmFsRGVzdGluYXRpb25Cb3R0b20gPSBkaXN0YW5jZVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZmluYWxEZXN0aW5hdGlvbkJvdHRvbSA9IDBcbiAgICAgIH1cblxuICAgICAgYW5pbWF0ZSh7XG4gICAgICAgIGR1cmF0aW9uOiBkdXJhdGlvblNldFtpbmRleF0sXG4gICAgICAgIHRpbWluZzogZnVuY3Rpb24gKHRpbWVGcmFjdGlvbikge1xuICAgICAgICAgIHJldHVybiBNYXRoLnBvdyh0aW1lRnJhY3Rpb24sIHBvdylcbiAgICAgICAgfSxcbiAgICAgICAgZHJhdzogZnVuY3Rpb24ocHJvZ3Jlc3MpIHtcbiAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGRiYUVsZW1zW2luZGV4XS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgZGJhRWxlbXNbaW5kZXhdW2ldLnN0eWxlLnRyYW5zZm9ybSA9ICd0cmFuc2xhdGVZKCcrKCgxLXByb2dyZXNzKSpjdXJyZW50VG9wREJBW2luZGV4XSArIHByb2dyZXNzKihmaW5hbERlc3RpbmF0aW9uQm90dG9tKSkrJ3B4KSc7XG4gICAgICAgICAgfVxuICAgICAgICAgIG5ld1RvcERCQVtpbmRleF0gPSAoMS1wcm9ncmVzcykqY3VycmVudFRvcERCQVtpbmRleF0gKyBwcm9ncmVzcyooZmluYWxEZXN0aW5hdGlvbkJvdHRvbSk7XG5cbiAgICAgICAgICBpZiAocHJvZ3Jlc3MgPT0gMSAmJiBpbmRleCA9PSBpbmRleE9mU2xvd2VzdCkge1xuICAgICAgICAgICAgcmVzKCk7XG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICB9KVxufVxuLy9lbmRcblxuLy9leGVjdXRpbmdcbndpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwibG9hZFwiLCBmdW5jdGlvbigpe1xuICBsZXQgc2hpZnRUb3AgPSBbMCwgd2luZG93LmlubmVySGVpZ2h0KjAuMjIsIHdpbmRvdy5pbm5lckhlaWdodCowLjAyXTtcbiAgbGV0IHNoaWZ0Qm90dG9tID0gW3dpbmRvdy5pbm5lckhlaWdodCowLjQsIHdpbmRvdy5pbm5lckhlaWdodCowLjIyLCBwaG9uZUhlaWdodCoyXVxuXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgc2xpZGVQaG9uZXMubGVuZ3RoOyBpKyspIHtcbiAgICBpbml0VG9wW2ldID0gc2xpZGVQaG9uZXNbaV0ub2Zmc2V0VG9wICsgc2hpZnRUb3BbaV07XG4gIH1cbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBzbGlkZVBob25lcy5sZW5ndGg7IGkrKykge1xuICAgIGZpbmFsVG9wW2ldID0gKGluaXRUb3BbaV0gKyA1LjMqcGhvbmVIZWlnaHQgLSBzaGlmdFRvcFtpXSAtIHNoaWZ0Qm90dG9tW2ldKTtcbiAgfVxuXG4gIGlmIChjdXJyZW50UG9zKCkgPiBkYmFTZWN0aW9uKCkpIHtcbiAgICBmaXJzdEVudGVyTXVzdGFuZyA9IGZhbHNlO1xuICAgIGZpcnN0RW50ZXJEQkEgPSB0cnVlO1xuICAgIG5ld1RvcERCQSA9IFswLCAwLCAwXTtcbiAgICBmaW5hbERlc3RpbmF0aW9uQm90dG9tID0gZGlzdGFuY2U7XG4gICAgbmV3VG9wQ2VjaWwgPSBbKC0xKSpkaXN0YW5jZSwgKC0xKSpkaXN0YW5jZSwgKC0xKSpkaXN0YW5jZV07XG4gICAgZmluYWxEZXN0aW5hdGlvblRvcCA9IDA7XG4gICAgY3VycmVudFByb2dyZXNzID0gWy4uLmluaXRUb3BdO1xuICAgIGZpbmFsVG9wQXJyYXkgPSBbLi4uZmluYWxUb3BdO1xuICAgIHN0YXJ0VG9wQXJyYXkgPSBbLi4uY3VycmVudFByb2dyZXNzXTtcbiAgICBcbiAgICBjaGFuZ2UoZ3JhZERCQSwgZ3JhZE11c3RhbmcsIGFydGljbGUsIGR1cmF0aW9uWmVybyk7XG4gICAgdG9wTW92ZShkdXJhdGlvblplcm8pXG4gICAgICAudGhlbigoKSA9PiBtb2JpbGVNb3ZlKGR1cmF0aW9uWmVybykpXG4gICAgICAudGhlbigoKSA9PiBib3R0b21Nb3ZlKGR1cmF0aW9uWmVybykpXG5cbiAgfSBlbHNlIHtcbiAgICBmaXJzdEVudGVyREJBID0gZmFsc2U7XG4gICAgZmlyc3RFbnRlck11c3RhbmcgPSB0cnVlO1xuICAgIG5ld1RvcERCQSA9IFtkaXN0YW5jZSwgZGlzdGFuY2UsIGRpc3RhbmNlXTtcbiAgICBmaW5hbERlc3RpbmF0aW9uQm90dG9tID0gMDtcbiAgICBuZXdUb3BDZWNpbCA9IFswLCAwLCAwXTtcbiAgICBmaW5hbERlc3RpbmF0aW9uVG9wID0gKC0xKSpkaXN0YW5jZTtcbiAgICBjdXJyZW50UHJvZ3Jlc3MgPSBbLi4uZmluYWxUb3BdO1xuICAgIGZpbmFsVG9wQXJyYXkgPSBbLi4uaW5pdFRvcF07XG4gICAgc3RhcnRUb3BBcnJheSA9IFsuLi5jdXJyZW50UHJvZ3Jlc3NdO1xuXG4gICAgY2hhbmdlKGdyYWRNdXN0YW5nLCBncmFkREJBLCBhcnRpY2xlLCBkdXJhdGlvblplcm8pO1xuICAgIGJvdHRvbU1vdmUoZHVyYXRpb25aZXJvKVxuICAgICAgLnRoZW4oKCkgPT4gbW9iaWxlTW92ZShkdXJhdGlvblplcm8pKVxuICAgICAgLnRoZW4oKCkgPT4gdG9wTW92ZShkdXJhdGlvblplcm8pKVxuICB9XG4gIFxuICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwic2Nyb2xsXCIsIGZ1bmN0aW9uKGV2ZW50KSB7XG5cbiAgICBpZiAoY3VycmVudFBvcygpID09IGRiYVNlY3Rpb24oKSAmJiBmaXJzdEVudGVyREJBID09IHRydWUpIHtcbiAgICAgIGxldCBwcm9taXNlREJBID0gbmV3IFByb21pc2UoKHJlcywgcmVqKSA9PiB7XG4gICAgICAgIHN0b3BNb3ZlID0gdHJ1ZTtcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgcmVzKCk7XG4gICAgICAgIH0sIDApXG4gICAgICB9KTtcbiAgICAgIHByb21pc2VEQkEudGhlbigoKSA9PiB7XG4gICAgICAgIHN0b3BNb3ZlID0gZmFsc2U7XG5cbiAgICAgICAgZmluYWxEZXN0aW5hdGlvbkJvdHRvbSA9IDA7XG4gICAgICAgIGZpbmFsRGVzdGluYXRpb25Ub3AgPSAoLTEpKmRpc3RhbmNlO1xuICAgICAgICBmaW5hbFRvcEFycmF5ID0gWy4uLmluaXRUb3BdO1xuICAgICAgICBzdGFydFRvcEFycmF5ID0gWy4uLmN1cnJlbnRQcm9ncmVzc107XG5cbiAgICAgICAgY2hhbmdlKGN1cnJlbnRHcmFkLCBncmFkREJBLCBhcnRpY2xlLCBkdXJhdGlvblRpbWVCRyk7XG4gICAgICAgIGJvdHRvbU1vdmUoZHVyYXRpb25TZXRBZGRpdGlvbmFsKVxuICAgICAgICAgIC50aGVuKCgpID0+IG1vYmlsZU1vdmUoZHVyYXRpb25UaW1lKSlcbiAgICAgICAgICAudGhlbigoKSA9PiB0b3BNb3ZlKGR1cmF0aW9uU2V0QWRkaXRpb25hbCkpXG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgZmlyc3RFbnRlckRCQSA9IGZhbHNlO1xuICAgICAgZmlyc3RFbnRlck11c3RhbmcgPSB0cnVlO1xuXG4gICAgfSBlbHNlIGlmIChjdXJyZW50UG9zKCkgPT0gbXVzdGFuZ1NlY3Rpb24oKSAmJiBmaXJzdEVudGVyTXVzdGFuZyA9PSB0cnVlKSB7XG4gICAgICBsZXQgcHJvbWlzZU11c3RhbmcgPSBuZXcgUHJvbWlzZSgocmVzLCByZWopID0+IHtcbiAgICAgICAgc3RvcE1vdmUgPSB0cnVlO1xuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICByZXMoKTtcbiAgICAgICAgfSwgMClcbiAgICAgIH0pO1xuICAgICAgcHJvbWlzZU11c3RhbmcudGhlbigoKSA9PiB7XG4gICAgICAgIHN0b3BNb3ZlID0gZmFsc2U7XG5cbiAgICAgICAgZmluYWxEZXN0aW5hdGlvblRvcCA9IDA7XG4gICAgICAgIHN0YXJ0VG9wQXJyYXkgPSBbLi4uY3VycmVudFByb2dyZXNzXTtcbiAgICAgICAgZmluYWxUb3BBcnJheSA9IFsuLi5maW5hbFRvcF07XG4gICAgICAgIGZpbmFsRGVzdGluYXRpb25Cb3R0b20gPSBkaXN0YW5jZTtcblxuICAgICAgICBjaGFuZ2UoY3VycmVudEdyYWQsIGdyYWRNdXN0YW5nLCBhcnRpY2xlLCBkdXJhdGlvblRpbWVCRyk7XG4gICAgICAgIHRvcE1vdmUoZHVyYXRpb25TZXRBZGRpdGlvbmFsKVxuICAgICAgICAgIC50aGVuKCgpID0+IG1vYmlsZU1vdmUoZHVyYXRpb25UaW1lKSlcbiAgICAgICAgICAudGhlbigoKSA9PiBib3R0b21Nb3ZlKGR1cmF0aW9uU2V0QWRkaXRpb25hbCkpXG4gICAgICB9KTtcblxuICAgICAgZmlyc3RFbnRlck11c3RhbmcgPSBmYWxzZTtcbiAgICAgIGZpcnN0RW50ZXJEQkEgPSB0cnVlO1xuICAgIH1cbiAgfSk7XG5cbn0pOyJdLCJmaWxlIjoibWFpbi5qcyJ9
